---
layout: post
title: 高效语义分割——BiSeNetv2的网络设计与训练策略
date: 2024-10-09 20:30:00
description: BiSeNetv2 通过双分支结构同时保留空间细节与全局语义信息，实现轻量高效的语义分割，兼顾速度与精度。
thumbnail: /assets/img/blogs/bisenetv2/cover.jpg
tags: [图像分割, 图像处理与视觉算法, 计算机视觉]
categories: 项目实践
---

在前两篇文章中，我们梳理了从 **FCN** 到 **DeepLab 系列** 的演化过程。  
这些方法显著提升了语义分割的精度，尤其是 DeepLab 系列通过空洞卷积和多尺度上下文有效增强了全局建模能力。  

然而，这类模型普遍存在一个现实问题：**计算量大、推理速度慢**。在自动驾驶、视频监控、AR/VR 等需要实时响应的场景中，它们往往难以直接落地。  
因此，研究的重心逐渐转向了 **高效轻量化分割模型** —— 如何在 **保证精度** 的前提下，实现 **更快的推理速度**。


---

#### **📌 背景介绍**

为了加速分割模型的训练与推理，常见方法包括：

- **裁剪或 resize 限定输入大小**：会损失细节，导致精度下降。  
- **减少网络通道数量**：降低特征提取能力，弱化空间表达。  
- **丢弃最后阶段下采样**（如 ENet）：特征尺寸较大 → 感受野不足 → 大物体识别困难。  

**总结**：这些方法都依赖于 **丢失细节** 或 **牺牲空间表达能力** 来换取效率。  

一些改进措施（如 U-shape）利用跳跃连接在上采样时恢复细节，但计算开销较大，且下采样丢失的信息无法完全逆转。

---

#### **📌 BiSeNetv2 网络架构**

核心思想：**双分支结构** ——  
- **细节分支**：保留高分辨率的细节特征。  
- **语义分支**：快速下采样，提取全局语义特征。  
- **BGALayer**：引导聚合层，融合两类特征。  
- **SegmentHead**：辅助训练，提高精度而不增加推理开销。  

<div style="text-align:center">
  <img src="/assets/img/blogs/bisenetv2/image-20250905194552447.png" alt="BiSeNetv2整体结构" style="max-width:90%; height:auto;">
</div>

---

#### **1. 细节分支（Detail Branch）**

三层卷积-归一化-激活结构：  
- 输入通道数 3 → 128  
- 分辨率缩小至 1/8  

👉 负责捕获图像的低级细节与高分辨率特征。

---

#### **2. 语义分支（Semantic Branch）**

分辨率逐步缩小至 1/32，通道数 3 → 128。  
包含以下关键模块：

**(1) StemBlock：高效初始下采样**  

- 左右双路径：  
  - 左：卷积下采样，学习抽象特征  
  - 右：最大池化，保留显著特征  
- 拼接后得到平衡抽象与细节的特征  

<div style="text-align:center">
  <img src="/assets/img/blogs/bisenetv2/image-20250612112210233.png" alt="StemBlock结构" style="max-width:80%; height:auto;">
</div>

---

**(2) GELayerS2：带残差的 2 倍下采样卷积层**  

- 主路径：预卷积 → 深度下采样 → 增强 → 压缩  
- 残差路径：深度下采样 → 通道调整  
- 融合后既保证信息压缩，又避免原始信息丢失  

<div style="text-align:center">
  <img src="/assets/img/blogs/bisenetv2/image-20250612115615598.png" alt="GELayerS2结构" style="max-width:80%; height:auto;">
</div>

---

**(3) GELayerS1：不改变分辨率的特征增强层**  

- 主路径：卷积 → 深度扩展 → 压缩  
- 残差路径：原输入  
- 融合后增强特征表达  

<div style="text-align:center">
  <img src="/assets/img/blogs/bisenetv2/image-20250612115359138.png" alt="GELayerS1结构" style="max-width:80%; height:auto;">
</div>

---

**(4) CEBlock：全局上下文建模**  

- 全局平均池化 (GAP) 提取通道全局特征  
- 标准化 & 卷积增强  
- 将全局特征广播回每个位置，实现 **全局-局部融合**  

<div style="text-align:center">
  <img src="/assets/img/blogs/bisenetv2/image-20250612114432081.png" alt="CEBlock结构" style="max-width:80%; height:auto;">
</div>

---

#### **3. BGALayer：双分支融合**

利用 **语义分支主导的自注意力门控机制**，引导细节分支：  

- 抑制无关区域  
- 强化目标区域  
- 保持高分辨率细节  

<div style="text-align:center">
  <img src="/assets/img/blogs/bisenetv2/image-20250612162908983.png" alt="BGALayer结构" style="max-width:85%; height:auto;">
</div>

---

#### **4. SegmentHead：辅助训练与推理**

- 多级放大（不同尺度上采样）  
- 特征精修，边界优化  
- 类别校准，像素级预测  
- 训练阶段：增加辅助监督信号，加速收敛  
- 推理阶段：可丢弃，不增加额外开销  

---

#### **📌 总结**

BiSeNetv2 设计要点：

1. **双分支结构**：细节分支捕获空间信息，语义分支获取全局语境。  
2. **BGALayer**：实现高效的跨分支特征融合。  
3. **辅助训练策略**：提升精度而不增加推理开销。  

相比以往单一路径网络，BiSeNetv2 彻底解决了 **“既要细节又要全局”** 的矛盾，在速度和精度上实现平衡。  

👉 这也是为什么 BiSeNetv2 能成为实时语义分割任务的代表性方法。

---

#### **📌 权重初始化与训练流程**

- **权重初始化**  
  - 卷积/线性层：`N(0, √(2/fan_out))` 随机采样，偏置清零  
  - BN 层：普通 BN (γ=1, β=0)，最后一层 BN (γ=0, β=0)  

- **训练流程**  
  1. 数据送入 GPU  
  2. 清空梯度  
  3. **自动混合精度训练 (AMP)**  
     - FP16：卷积、矩阵乘法（高效低精度）  
     - FP32：归约操作、Loss 计算（稳定高精度）  
  4. 计算主损失 + 辅助损失  
  5. 反向传播与参数更新  

---

#### **📌 结语**

BiSeNetv2 在语义分割领域提出了一个兼顾速度与精度的解决方案，特别适合 **交通、自动驾驶等实时场景**。  
它不仅提供了强大的特征建模能力，还启发我们在网络设计中如何平衡 **局部细节与全局语义**。

> **一句话总结**：BiSeNetv2 的设计逻辑就是——细节分支保真，语义分支提纲，两者在 BGALayer 中高效融合。

---

<div class="post-navigation" style="margin-top:2rem; padding-top:1rem; border-top:1px solid #eaeaea;">
  <p style="margin-bottom:0.5rem; font-weight:600;">📖 系列文章导航</p>
  <ul style="list-style:none; padding-left:0;">
    <li>⬅️ 上一篇：<a href="{{ '/blog/2024/development-cnn-segment' | relative_url }}">语义分割发展历程——FCNN、SegNet、U-Net、PSPNet与DeepLab</a></li>
    <li>➡️ 下一篇：<a href="{{ '/blog/2024/segformer' | relative_url }}">Transformer架构浅述</a></li>
  </ul>
</div>
